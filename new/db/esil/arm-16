NAME=cmp neq unchanged zf
FILE=malloc://0x200
CMDS=<<EXPECT
e esil.debug=true
e asm.arch=arm
e asm.bits=16
aei
aeim
aer sp=0x00108000
.aer*
wa cmp r1, 16
aes
?v cpsr & 0xf0000000
EXPECT=<<RUN
0x80000000
RUN

NAME=cmp neq changed zf
FILE=malloc://0x200
CMDS=<<EXPECT
e esil.debug=true
e asm.arch=arm
e asm.bits=16
aei
aeim
aer sp=0x00108000
aer cpsr=0xffffffff
.aer*
wa cmp r1, 16
aes
?v cpsr & 0xf0000000
EXPECT=<<RUN
0x80000000
RUN

NAME=cmp eq unchanged zf
FILE=malloc://0x200
CMDS=<<EXPECT
e esil.debug=true
e asm.arch=arm
e asm.bits=16
aei
aeim
aer sp=0x00108000
aer r1=0x10
aer cpsr=0x40000000
.aer*
wa cmp r1, 16
aes
?v cpsr & 0xf0000000
EXPECT=<<RUN
0x60000000
RUN

NAME=cmp eq changed zf
FILE=malloc://0x200
CMDS=<<EXPECT
e esil.debug=true
e asm.arch=arm
e asm.bits=16
aei
aeim
aer sp=0x00108000
aer r1=0x10
aer cpsr=0x00000000
.aer*
wa cmp r1, 16
aes
?v cpsr & 0xf0000000
EXPECT=<<RUN
0x60000000
RUN

NAME=ldr.w r0, [r0, r1, lsl 2]
FILE=malloc://0x200
BROKEN=1
EXPECT64=MHgxMTIyMzM0NAoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYXIgPiAvZGV2L251bGwKYXIgcjA9NAphciByMT0yCnd4IDUwZjgyMTAwCnd4IGFhYWFhYWFhYmJiYmJiYmI0NDMzMjIxMUA0CmFlcwphciByMAoK
RUN
NAME=ldm r3!, {r1, r4, r5}
FILE=malloc://0x200
BROKEN=1
EXPECT64=MHgxMTExMTExMQoweDQ0NDQ0NDQ0CjB4NTU1NTU1NTUKMHgwMDAwMDAxMAoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYXIgPiAvZGV2L251bGwKYXIgcjM9NAkJIyBhZGRyZXNzCmFyIHIxPTAJCSMgaW5pdCB3aXRoIGR1bW15IHZhbHVlcwphciByND0wCmFyIHI1PTAKd3ggMzJjYgp3eCAxMTExMTExMTQ0NDQ0NDQ0NTU1NTU1NTVANAphZXMKYXIgcjE7IGFyIHI0OyBhciByNTsgYXIgcjMKCg==
RUN
NAME=stm r2!, {r1, r4, r5}
FILE=malloc://0x200
BROKEN=1
EXPECT64=MHgxMTExMTExMQoweDQ0NDQ0NDQ0CjB4NTU1NTU1NTUKMHgwMDAwMDAxMAoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYXIgPiAvZGV2L251bGwKYXIgcjI9NAkJIyBhZGRyZXNzCmFyIHIxPTB4MTExMTExMTEKYXIgcjQ9MHg0NDQ0NDQ0NAphciByNT0weDU1NTU1NTU1Cnd4IDMyYzIKYWVzCnBmdiB4IEAgNDsgcGZ2IHggQCA4OyBwZnYgeCBAIDEyOyBhciByMgoK
RUN
NAME=ubfx r2, r0, 8, 8
FILE=malloc://0x200
EXPECT64=MHgwMDAwMDAzMwoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYXIgPiAvZGV2L251bGwKYXIgcjA9MHgxMTIyMzM0NAp3eCBjMGYzMDcyMgphZXMKYXIgcjIKCg==
RUN
NAME=it eq
FILE=malloc://0x200
EXPECT64=MHgwIHpmLD97LDQscGMsKz0sfQoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggMDhiZgphb2UKCg==
RUN
NAME=it ne
FILE=malloc://0x200
EXPECT64=MHgwIHpmLCEsP3ssNCxwYywrPSx9Cgo=
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggMThiZjAwMDAwMDAwCmFvZQoK
RUN
NAME=it hs
FILE=malloc://0x200
EXPECT64=MHgwIGNmLD97LDQscGMsKz0sfQoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggMjhiZjAwMDAwMDAwCmFvZQoK
RUN
NAME=it lo
FILE=malloc://0x200
EXPECT64=MHgwIGNmLCEsP3ssNCxwYywrPSx9Cgo=
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggMzhiZjAwMDAwMDAwCmFvZQoK
RUN
NAME=it mi
FILE=malloc://0x200
EXPECT64=MHgwIG5mLD97LDQscGMsKz0sfQoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggNDhiZjAwMDAwMDAwCmFvZQoK
RUN
NAME=it pl
FILE=malloc://0x200
EXPECT64=MHgwIG5mLCEsP3ssNCxwYywrPSx9Cgo=
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggNThiZjAwMDAwMDAwCmFvZQoK
RUN
NAME=it vs
FILE=malloc://0x200
EXPECT64=MHgwIHZmLD97LDQscGMsKz0sfQoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggNjhiZjAwMDAwMDAwCmFvZQoK
RUN
NAME=it vc
FILE=malloc://0x200
EXPECT64=MHgwIHZmLCEsP3ssNCxwYywrPSx9Cgo=
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggNzhiZjAwMDAwMDAwCmFvZQoK
RUN
NAME=it al
FILE=malloc://0x200
EXPECT64=MHgwIDQscGMsKz0KCg==
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggZThiZjAwMDAwMDAwCmFvZQoK
RUN
NAME=ldr r2, [r3, r1]
FILE=malloc://0x200
EXPECT64=MHhlZWRkY2NiYgoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYXIgcjM9MQphciByMT0yCnd4IDVhNThhYWJiY2NkZGVlZmYKYWVzCmFyIHIyCgo=
RUN
NAME=lsrs r4, r4, 2
FILE=malloc://0x200
EXPECT64=MHgzZmZmZmZmZQoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYXIgPiAvZGV2L251bGwKYXIgcjQ9LTgKd3ggYTQwOAphZXMKYXIgcjQKCg==
RUN
NAME=asrs r4, r4, 2
FILE=malloc://0x200
EXPECT64=MHhmZmZmZmZmZQoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYXIgPiAvZGV2L251bGwKYXIgcjQ9LTgKd3ggYTQxMAphZXMKYXIgcjQKCg==
RUN
NAME=orn
FILE=malloc://0x200
EXPECT64=MHhmZmZmZmZmYgoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYXIgcjE9MHgzCmFyIHIyPTB4Nwp3diAweDAwMDJlYTYxCmFlcwphciByMAoK
RUN
NAME=add pc
FILE=malloc://0x200
EXPECT64=MHgwMDAwMDAwNAoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3YgMHg0NDc4CmFlcwphciByMAoK
RUN
NAME=ldm.w r0, {r4, r6}
FILE=malloc://0x200
EXPECT64=MHgxMTIyMzM0NAoweDU1NjY3Nzg4Cgo=
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggOTBlODUwMDAKd3YgMHgxMTIyMzM0NCBAIDQKd3YgMHg1NTY2Nzc4OCBAIDgKYWVyIHIwPTQKYWVzCmFyIHI0CmFyIHI2Cgo=
RUN
NAME=ldr wrapping around addresses
FILE=malloc://0x200
EXPECT64=MHgxMTIyMzM0NAoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggNzE1OCAjbGRyIHIxLCBbcjYsIHIxXQp3diAweDExMjIzMzQ0IEAgMgphZXIgcjE9MHg0Nzk2ZWViZQphZXIgcjY9MHhiODY5MTE0NAphZXMKYXIgcjEKCg==
RUN
NAME=add wrapping around
FILE=malloc://0x200
EXPECT64=MHgwMDAwMDAwMgoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggMDE0NCAjYWRkIHIxLCByMAphZXIgcjE9MHg0Nzk2ZWViZQphZXIgcjA9MHhiODY5MTE0NAphZXMKYXIgcjEKCg==
RUN
NAME=smmla
FILE=malloc://0x200
EXPECT64=MHgwMDAwMDAxNQoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggNTFmYjAwMDEgI3NtbWxhIHIxLCByMSwgcjAsIHIwCmFlciByMT0weDQ3OTZlZWJlCmFlciByMD0weDExCmFlcwphciByMQoK
RUN
NAME=smmlar
FILE=malloc://0x200
EXPECT64=MHgwMDAwMDAxNgoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggNTFmYjEwMDEgI3NtbWxhciByMSwgcjEsIHIwLCByMAphZXIgcjE9MHg0Nzk2ZWViZQphZXIgcjA9MHgxMQphZXMKYXIgcjEKCg==
RUN
NAME=umull
FILE=malloc://0x200
EXPECT64=MHhjMTA1ZGE5ZQoweDAwMDAwMDA0Cgo=
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggYTFmYjAyMTIgI3VtdWxsIHIxLCByMiwgcjEsIHIyCmFlciByMT0weDQ3OTZlZWJlCmFlciByMj0weDExCmFlcwphciByMQphciByMgoK
RUN
NAME=mls
FILE=malloc://0x200
EXPECT64=MHgwZmZjZjAxMgoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggMDFmYjEyMDAgI21scyByMCwgcjEsIHIyLCByMAphZXIgcjA9MHgxNjE2MTYxNgphZXIgcjE9MHg0NQphZXIgcjI9MHg3ODIzODM0CmFlcwphciByMAoK
RUN
NAME=mla
FILE=malloc://0x200
EXPECT64=MHgxYzJmM2MxYQoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggMDBmYjAyMTEgI21sYSByMSwgcjAsIHIyLCByMQphZXIgcjE9MHgxNjE2MTYxNgphZXIgcjA9MHg0NQphZXIgcjI9MHg3ODIzODM0CmFlcwphciByMQoK
RUN
NAME=mvn
FILE=malloc://0x200
EXPECT64=MHhmZmZmZmZlZAoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKd3ggNmZmMDEyMDEgI212biByMSwgMHgxMgphZXMKYXIgcjEKCg==
RUN
NAME=bfc
FILE=malloc://0x200
EXPECT64=MHg2OTY5Njk4MAoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYWVyIHI0PTB4Njk2OTY5ZjkKd3ggNmZmMzA2MDQgI2JmYyByNCwgMCwgNwphZXMKYXIgcjQKCg==
RUN
NAME=bfi
FILE=malloc://0x200
EXPECT64=MHgzMzMzMzNlNwoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYWVyIHIyPTB4Njk2OTY5ZjkKYWVyIHIzPTB4MzMzMzMzMzMKd3ggNjJmMzg3MDMgI2JmaSByMywgcjIsIDIsIDYKYWVzCmFyIHIzCgo=
RUN
NAME=rev
FILE=malloc://0x200
EXPECT64=MHg0NDMzMjIxMQoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYWVyIHI1PTB4MTEyMjMzNDQKd3ggMmJiYSAjcmV2IHIzLCByNQphZXMKYXIgcjMKCg==
RUN
NAME=rev16
FILE=malloc://0x200
EXPECT64=MHgyMjExNDQzMwoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYWVyIHI3PTB4MTEyMjMzNDQKd3ggN2ViYSAjcmV2MTYgcjYsIHI3CmFlcwphciByNgoK
RUN
NAME=revsh positive
FILE=malloc://0x200
EXPECT64=MHgwMDAwNDQzMwoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYWVyIHIxPTB4MTEyMjMzNDQKd3ggY2ZiYSAjcmV2c2ggcjcsIHIxCmFlcwphciByNwoK
RUN
NAME=revsh negative
FILE=malloc://0x200
EXPECT64=MHhmZmZmODgzMwoK
CMDS64=CmUgYXNtLmFyY2g9YXJtCmUgYXNtLmJpdHM9MTYKYWVyIHIxPTB4MTEyMjMzODgKd3ggY2ZiYSAjcmV2c2ggcjcsIHIxCmFlcwphciByNwoK
RUN
NAME=cbz/cbnz likeliness
FILE=malloc://0x200
EXPECT64=ICAgICAgICAgICAgMHgwMDAwMDAwMCAgICAgIDAwMjAgICAgICAgICAgIG1vdnMgcjAsIDAKICAgICAgICAgICAgMHgwMDAwMDAwMiAgICAgIDAxMjEgICAgICAgICAgIG1vdnMgcjEsIDEKICAgICAgICAsPTwgMHgwMDAwMDAwNCAgICAgIDAwYjEgICAgICAgICAgIGNieiByMCwgOCAgICAgICAgICAgICAgICAgICA7IGxpa2VseQogICAgICAgIHwgICAweDAwMDAwMDA2ICAgICAgMDBiZiAgICAgICAgICAgbm9wCiAgICAgICAgYC0+IDB4MDAwMDAwMDggICAgICAwMDIwICAgICAgICAgICBtb3ZzIHIwLCAwCiAgICAgICAgICAgIDB4MDAwMDAwMGEgICAgICAwMTIxICAgICAgICAgICBtb3ZzIHIxLCAxCiAgICAgICAgLD08IDB4MDAwMDAwMGMgICAgICAwMGI5ICAgICAgICAgICBjYm56IHIwLCAweDEwICAgICAgICAgICAgICAgOyB1bmxpa2VseQoK
CMDS64=ZSBhc20uYXJjaD1hcm0KZSBhc20uYml0cz0xNgplIGNmZy5iaWdlbmRpYW49ZmFsc2UKZSBlbXUuc3RyPXRydWUKd3YyIDB4MjAwMAp3djIgMHgyMTAxIEAgMgp3djIgMHhiMTAwIEAgNAp3djIgMHhiZjAwIEAgNgp3djIgMHgyMDAwIEAgOAp3djIgMHgyMTAxIEAgMTAKd3YyIDB4YjkwMCBAIDEyCnBkIDcKCg==
RUN

NAME=pc points to next instruction
FILE=malloc://0x200
CMDS=<<EXPECT
e asm.arch=arm
e asm.bits=16
wx 7846 # mov r0, pc
aes
aer r0
EXPECT=<<RUN
0x00000002
RUN

NAME=lr correct after bl
FILE=malloc://0x200
CMDS=<<EXPECT
e asm.arch=arm
e asm.bits=16
wx 00f002f8 # bl 8
aes
aer lr
aer pc
EXPECT=<<RUN
0x00000004
0x00000008
RUN
